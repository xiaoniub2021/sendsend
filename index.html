<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>AutoSender Pro</title>
    <!-- 添加 favicon，避免404错误 -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📨</text></svg>">
    <!-- 全局样式和字体设置 -->
    <link rel="stylesheet" href="static/mainpage.css?v=20260114_1">
    <!-- 登录页面样式 -->
    <link rel="stylesheet" href="static/loginpage.css?v=20260114_1">
</head>

<body>
    
    <!--#region 登录页面 HTML -->

    <div class="login-page" id="loginPage" style="display: flex;">
        <!-- 右上角服务器管理入口（独立功能，需要管理员密码验证） -->
        <button class="admin-entry-btn" onclick="showAdminModal()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
            </svg>
            服务器管理
        </button>

        <!-- 标题区域 -->
        <div class="login-title-area">
            <div class="login-main-title">AutoSender Pro</div>
            <div class="login-main-subtitle">IMessage sender</div>
        </div>

        <!-- 登录面板 -->
        <div class="login-panel" id="loginPanel">
            <div class="login-panel-header">
                <h1 class="login-logo">用户登录</h1>
            </div>

            <div class="login-panel-content">
                <!-- Admin 切换按钮 -->
                <div class="user-admin-toggle">
                    <button class="toggle-btn btn-admin" id="adminToggle" onclick="switchToAdmin()">Admin</button>
                </div>

                <!-- 用户登录表单 -->
                <div id="userLoginForm">
                    <form novalidate onsubmit="handleLogin(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="loginUsername" placeholder="用户名"
                                autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="loginPassword" placeholder="密码"
                                    autocomplete="current-password">
                                <button type="button" class="show-password-btn"
                                    onclick="togglePassword('loginPassword', this)">👁️</button>
                            </div>
                        </div>
                        <div class="forgot-password">
                            <a href="#" class="forgot-password-link"
                                onclick="handleForgotPassword(); return false;">忘记密码？</a>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary btn-register"
                                onclick="showRegister()">注册</button>
                            <button type="submit" class="btn-primary">登录</button>
                        </div>
                    </form>
                </div>

                <!-- 管理员登录表单 -->
                <div id="adminLoginForm" style="display: none;">
                    <form novalidate onsubmit="handleAdminLogin(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="adminLoginUsername" placeholder="管理员用户名"
                                autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="adminLoginPassword" placeholder="管理员密码"
                                    autocomplete="current-password">
                                <button type="button" class="show-password-btn"
                                    onclick="togglePassword('adminLoginPassword', this)">👁️</button>
                            </div>
                        </div>
                        <div class="forgot-password" style="visibility: hidden;">
                            <a href="#" class="forgot-password-link">占位</a>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary" onclick="switchToUser()">返回</button>
                            <button type="submit" class="btn-primary">登录</button>
                        </div>
                    </form>
                </div>

                <!-- 注册表单 -->
                <div id="registerForm" style="display: none;">
                    <form novalidate onsubmit="handleRegister(); return false;">
                        <div class="form-group">
                            <input type="text" class="form-input" id="registerUsername" placeholder="请设置用户名"
                                autocomplete="username">
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="registerPassword" placeholder="请设置密码,至少4位"
                                    autocomplete="new-password">
                                <button type="button" class="show-password-btn"
                                    onclick="togglePassword('registerPassword', this)">👁️</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="password-wrapper">
                                <input type="password" class="form-input" id="registerConfirmPassword"
                                    placeholder="请确认密码,至少4位" autocomplete="new-password">
                                <button type="button" class="show-password-btn"
                                    onclick="togglePassword('registerConfirmPassword', this)">👁️</button>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn-secondary" onclick="showLogin()">返回</button>
                            <button type="submit" class="btn-primary">确定</button>
                        </div>
                    </form>
                </div>

                <div class="message-box" id="authMessage"></div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 自定义弹窗 HTML -->

    <div class="custom-modal-overlay" id="customModal">
        <div class="custom-modal-panel" id="customModalPanel">
            <div class="custom-modal-header">
                <span class="custom-modal-title" id="customModalTitle">提示</span>
                <button class="custom-modal-close" onclick="closeCustomModal()">×</button>
            </div>
            <div class="custom-modal-content" id="customModalContent">
                <div class="custom-modal-message" id="customModalMessage"></div>
                <input type="text" class="custom-modal-input" id="customModalInput" style="display: none;"
                    placeholder="">
                <div class="custom-modal-buttons" id="customModalButtons">
                    <!-- 动态生成按钮 -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 管理员密码弹窗 HTML -->

    <div class="modal-overlay" id="adminModal">
        <div class="modal-panel">
            <div class="modal-header">
                <span class="modal-title">
                    <svg viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">
                        <path
                            d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                    </svg>
                    服务器管理
                </span>
                <button class="modal-close" onclick="closeAdminModal()">×</button>
            </div>
            <div class="modal-content">
                <form onsubmit="event.preventDefault(); verifyAdminPassword();" autocomplete="off">
                    <input type="text" name="username" autocomplete="username" style="display:none;" value="admin">
                    <label class="modal-label">请输入管理员密码：</label>
                    <input type="password" class="modal-input" id="adminPasswordInput" placeholder="管理员密码"
                        autocomplete="current-password">
                    <button type="submit" class="modal-btn">确 认</button>
                    <div class="modal-message" id="adminMessage"></div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 服务器管理密码修改弹窗 HTML -->

    <div class="custom-modal-overlay" id="passwordChangeModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">🔐 服务器管理密码设置</span>
                <button class="custom-modal-close" onclick="closePasswordChangeModal()">×</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); updateServerManagerPassword();" autocomplete="off">
                    <input type="text" name="username" autocomplete="username" style="display:none;" value="server-manager">
                    <input type="password" class="custom-modal-input" id="oldPasswordInput" placeholder="请输入旧密码"
                        autocomplete="current-password">
                    <input type="password" class="custom-modal-input" id="newPasswordInput" placeholder="新密码"
                        autocomplete="new-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel"
                            onclick="closePasswordChangeModal()">取消</button>
                        <button type="submit" class="custom-modal-btn confirm">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 管理员账号密码修改弹窗 HTML -->

    <div class="custom-modal-overlay" id="adminPasswordChangeModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">🔐 修改管理员密码</span>
                <button class="custom-modal-close" onclick="closeAdminPasswordChangeModal()">×</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); updateAdminPassword();" autocomplete="off">
                    <input type="text" name="username" autocomplete="username" style="display:none;" id="adminUsernameHidden">
                    <input type="password" class="custom-modal-input" id="adminOldPasswordInput" placeholder="请输入旧密码"
                        autocomplete="current-password">
                    <input type="password" class="custom-modal-input" id="adminNewPasswordInput" placeholder="新密码"
                        autocomplete="new-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel"
                            onclick="closeAdminPasswordChangeModal()">取消</button>
                        <button type="submit" class="custom-modal-btn confirm">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region ID库面板 HTML -->
    <div class="custom-modal-overlay" id="idLibraryModal" style="display: none;">
        <div class="custom-modal-panel id-library-panel">
            <div class="custom-modal-header id-library-header">
                <span class="custom-modal-title">📋 ID库 - 账号管理</span>
                <button class="custom-modal-close" onclick="closeIdLibraryModal()">×</button>
            </div>
            <div class="custom-modal-content id-library-content">
                <!-- 顶部操作栏 -->
                <form onsubmit="event.preventDefault(); saveIdLibraryAccount();" autocomplete="off">
                    <div class="id-library-toolbar">
                        <div class="id-library-input-group">
                            <label>APPLE ID</label>
                            <input type="text" class="id-library-input" id="idLibraryAppleId" placeholder="输入Apple ID邮箱"
                                autocomplete="username">
                        </div>
                        <div class="id-library-input-group">
                            <label>PASSWORD</label>
                            <div class="password-input-wrapper">
                                <input type="password" class="id-library-input" id="idLibraryPassword"
                                    placeholder="输入密码" autocomplete="current-password">
                                <button type="button" class="password-toggle-btn"
                                    onclick="toggleIdLibraryPassword()">👁</button>
                            </div>
                        </div>
                        <button type="submit" class="id-library-btn btn-save">💾 保存</button>
                        <button type="button" class="id-library-btn btn-import" onclick="importIdLibraryAccounts()">📂
                            导入</button>
                        <button type="button" class="id-library-btn btn-clear" onclick="clearAllIdLibraryAccounts()">🗑️
                            清空</button>
                    </div>
                </form>

                <!-- 账号列表区域 -->
                <div class="id-library-list-container">
                    <div class="id-library-list-header">
                        <span class="header-col col-index">#</span>
                        <span class="header-col col-account">账号</span>
                        <span class="header-col col-password">密码</span>
                        <span class="header-col col-status">状态</span>
                        <span class="header-col col-usage-status">使用状态</span>
                        <span class="header-col col-actions">操作</span>
                    </div>
                    <div class="id-library-list" id="idLibraryList">
                        <!-- 账号列表项将通过JavaScript动态添加 -->
                        <div class="id-library-empty">
                            <div class="empty-icon">📭</div>
                            <div class="empty-text">暂无账号</div>
                            <div class="empty-hint">点击"保存"添加账号，或"导入"批量导入</div>
                        </div>
                    </div>
                </div>

                <!-- 底部统计栏 -->
                <div class="id-library-footer">
                    <div class="id-library-stats">
                        <span class="stat-item">总数: <strong id="idLibraryTotal">0</strong></span>
                        <span class="stat-item">正常: <strong id="idLibraryNormal"
                                style="color: #00d4aa;">0</strong></span>
                        <span class="stat-item">异常: <strong id="idLibraryError"
                                style="color: #ff6b6b;">0</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->

    <!--#region 积分充值面板 HTML -->

    <div class="custom-modal-overlay" id="rechargeModal" style="display: none;">
        <div class="custom-modal-panel"
            style="width: 70%; max-width: 800px; height: 85vh; max-height: 85vh; overflow-y: auto;">
            <div class="custom-modal-header">
                <span class="custom-modal-title">💰 积分充值</span>
                <button class="custom-modal-close" onclick="closeRechargeModal()">×</button>
            </div>
            <div class="custom-modal-content"
                style="padding: 20px; display: flex; flex-direction: column; height: calc(85vh - 100px);">
                <!-- 第一行：用户名输入、验证按钮、充值输入、确定按钮 -->
                <!-- 第一行：用户名输入、验证按钮、充值输入、确定按钮 -->
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px; flex-wrap: nowrap;">
                    <label
                        style="font-weight: bold; white-space: nowrap; font-size: 14px; height: 36px; line-height: 36px; display: flex; align-items: center; margin: 0; padding: 0;">用户名:</label>
                    <input type="text" class="custom-modal-input" id="rechargeUserIdInput" placeholder="输入用户注册的用户名"
                        style="width: 200px; height: 36px; box-sizing: border-box; margin: 0 !important; padding: 8px 12px;">
                    <button class="custom-modal-btn" onclick="verifyRechargeUser()"
                        style="white-space: nowrap; width: 100px; height: 36px; line-height: 36px; padding: 0; margin: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px;">验证</button>
                    <div style="width: 1px; height: 36px; background: #ddd; margin: 0 5px; flex-shrink: 0;"></div>
                    <label
                        style="font-weight: bold; white-space: nowrap; font-size: 14px; height: 36px; line-height: 36px; display: flex; align-items: center; margin: 0; padding: 0;">充值:</label>
                    <input type="number" class="custom-modal-input" id="rechargeAmountInput" placeholder="金额"
                        style="width: 120px; height: 36px; box-sizing: border-box; margin: 0 !important; padding: 8px 12px;"
                        step="0.01">
                    <button class="custom-modal-btn confirm" onclick="confirmRecharge()"
                        style="white-space: nowrap; width: 100px; height: 36px; line-height: 36px; margin: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px; background-color: #4CAF50; border-color: #4CAF50;">确定</button>
                    <button class="custom-modal-btn" onclick="finishRecharge()"
                        style="white-space: nowrap; width: 100px; height: 36px; line-height: 36px; margin: 0; display: flex; align-items: center; justify-content: center; background: #6c757d; color: white; border-radius: 8px;">完成</button>
                </div>

                <!-- 第二行：用户信息显示区域（固定高度，两行布局） -->
                <div id="rechargeUserInfo"
                    style="display: none; padding: 15px; background: #f5f5f5; border-radius: 8px; margin-bottom: 15px; height: 120px; border: 1px solid #ddd; overflow: hidden;">
                    <!-- 第一行：用户名、用户ID、注册时间 -->
                    <div
                        style="display: flex; gap: 30px; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">用户名:</strong>
                            <span id="rechargeInfoUsername"
                                style="color: #333; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">用户ID:</strong>
                            <span id="rechargeInfoUserId"
                                style="color: #333; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">注册时间:</strong>
                            <span id="rechargeInfoCreated" style="color: #333; font-size: 14px;">-</span>
                        </div>
                    </div>
                    <!-- 第二行：余额、上次充值、总消费 -->
                    <div style="display: flex; gap: 30px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">余额:</strong>
                            <span id="rechargeInfoCredits"
                                style="color: #4CAF50; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">上次充值:</strong>
                            <span id="rechargeInfoLastRecharge" style="color: #333; font-size: 13px;">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong style="color: #666; font-size: 13px; white-space: nowrap;">总消费:</strong>
                            <span id="rechargeInfoTotalSpent"
                                style="color: #FF9800; font-size: 14px; font-weight: bold;">-</span>
                        </div>
                    </div>
                </div>

                <!-- 充值记录区域 -->
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333; font-size: 18px;">充值记录</h3>
                    <div id="rechargeRecordsList"
                        style="background: white; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; max-height: 400px; overflow-y: auto;">
                        <div style="padding: 15px; text-align: center; color: #999;">请先验证用户以查看充值记录</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 添加管理员弹窗 HTML -->

    <div class="custom-modal-overlay" id="addAdminModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">👤 添加管理员账号</span>
                <button class="custom-modal-close" onclick="closeAddAdminModal()">×</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); addAdminAccount();" autocomplete="off">
                    <input type="text" class="custom-modal-input" id="newAdminId" placeholder="管理员ID"
                        autocomplete="username">
                    <input type="password" class="custom-modal-input" id="newAdminPassword" placeholder="密码"
                        autocomplete="new-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel" onclick="closeAddAdminModal()">取消</button>
                        <button type="submit" class="custom-modal-btn confirm">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 服务器管理面板 HTML -->

    <div class="admin-page" id="adminPage">
        <div class="admin-container">
            <!-- 头部 -->
            <div class="server-manager-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <h1>🔧 服务器管理 (Server Manager)</h1>
                    <button class="admin-back-btn btn-super-admin-small" onclick="showSuperAdminPasswordModal()">🔴
                        超级管理员</button>
                </div>
                <div class="manager-time-display" id="serverTimeDisplay">
                    <span class="time-date" id="serverTimeDate">--/--/----</span>
                    <span class="time-clock" id="serverTimeClock">--:--</span>
                </div>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <button class="admin-back-btn btn-id-library" onclick="showIdLibraryModal()"
                        style="padding: 10px 12px;font-size: 13px;">账号列表</button>
                    <button class="admin-back-btn" onclick="showPasswordChangeModal()"
                        style="padding: 10px 12px;font-size: 13px;background: #e2ff0b;">修改密码</button>
                    <button class="admin-back-btn btn-exit" onclick="backToLogin()"
                        style="padding: 10px 12px;font-size: 13px;">保存退出</button>
                </div>
            </div>

            <!-- 已连接和已断开服务器 -->
            <div class="server-status-section">
                <div class="server-status-header">
                    已连接 <span class="count" id="connectedCount">(0)</span>
                </div>
                <div class="server-buttons-grid" id="connectedServers">
                    <!-- 动态生成 -->
                </div>

                <div class="server-status-divider"></div>

                <div class="server-status-header">
                    已断开 <span class="count" id="disconnectedCount">(0)</span>
                </div>
                <div class="server-buttons-grid" id="disconnectedServers">
                    <!-- 动态生成 -->
                </div>
            </div>

            <!-- 管理员账户管理（用于登录窗口的管理员账号） -->
            <div class="admin-account-section">
                <h3>👤 创建管理员账号</h3>
                <div style="margin-bottom: 15px;">
                    <button class="admin-account-btn confirm" onclick="showAddAdminModal()">添加管理员</button>
                </div>
                <div class="admin-account-list" id="adminAccountList">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 管理员页面 HTML -->

    <div class="manager-page" id="managerPage" style="display: none;">
        <div class="manager-container">
            <!-- Header -->
            <div class="manager-header">
                <div class="manager-header-left">
                    <span style="margin-right: 20px;">管理员: <span id="managerIdDisplay">-</span></span>
                    <span style="margin-right: 20px;">客户: <span id="managerUserCountDisplay">0</span></span>
                    <span style="margin-right: 20px;">总业绩: <span id="totalPerformanceDisplay">0</span></span>
                </div>
                <div class="manager-time-display" id="managerTimeDisplay">
                    <span class="time-date" id="managerTimeDate">--/--/----</span>
                    <span class="time-clock" id="managerTimeClock">--:--</span>
                </div>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <button class="admin-back-btn btn-id-library" onclick="showIdLibraryModal()"
                        style="padding: 10px 12px;font-size: 13px;">账号列表</button>
                    <button class="admin-back-btn" onclick="showPasswordChangeModal()"
                        style="padding: 10px 12px;font-size: 13px;background: #e2ff0b;">修改密码</button>
                    <button class="admin-back-btn btn-exit" onclick="backToLogin()"
                        style="padding: 10px 12px;font-size: 13px;">保存退出</button>
                </div>

            </div>

            <!-- 面板0：在线服务器 -->
            <div class="manager-section" id="onlineServersPanel">
                <div
                    style="display: flex; align-items: center; justify-content: flex-start; gap: 8px; margin-bottom: 15px;">
                    <h3 class="panel-title" style="margin: 0;">在线服务器</h3>
                    <div style="position: relative;">
                        <button id="onlineServersHelpBtn" class="help-btn"
                            onclick="const t=document.getElementById('onlineServersHelpTooltip'); const show = t.style.visibility!=='visible'; t.style.opacity=show?'1':'0'; t.style.visibility=show?'visible':'hidden';"
                            style="width: 16px; height: 16px; border-radius: 50%; background: #4facfe; color: white; border: none; cursor: pointer; font-size: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center;">?</button>
                        <div id="onlineServersHelpTooltip"
                            style="position: absolute; left: calc(100% + 10px); top: 50%; transform: translateY(-50%); background-color: #000000; color: #ffffff; padding: 10px 15px; border-radius: 8px; font-size: 12px; white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; pointer-events: none; z-index: 2147483647; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); min-width: 150px;">
                            <div
                                style="font-weight: bold; margin-bottom: 5px; font-size: 13px; color: #ffffff; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 3px;">
                                说明</div>
                            <div style="font-size: 12px; color: #ffffff; line-height: 1.4;">定时随机提取10个服务器显示</div>
                            <!-- Arrow -->
                            <div
                                style="position: absolute; right: 100%; top: 50%; transform: translateY(-50%); border: 6px solid transparent; border-right-color: #000000;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="server-buttons-grid" id="onlineServersDisplay">

                </div>
            </div>

            <!-- 面板1：可分配服务器 -->
            <div class="manager-section" id="availableServersPanel">
                <h3 class="panel-title">可分配服务器</h3>
                <div id="managerAvailableServers">
                    <!-- 动态生成服务器按钮 -->
                </div>
            </div>

            <!-- 面板2：用户列表 -->
            <div class="manager-section" id="userListPanel">
                <div class="panel-header-row">
                    <h3 class="panel-title">用户列表</h3>
                    <button class="add-user-btn" onclick="showAddUserModal()">添加用户</button>
                </div>
                <div class="user-buttons-grid" id="userList">
                    <!-- 动态生成用户按钮 -->
                </div>
            </div>
        </div>
    </div>
    <!--#region 添加用户弹窗 HTML -->

    <div class="custom-modal-overlay" id="addUserModal">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">👤 添加用户</span>
                <button class="custom-modal-close" onclick="closeAddUserModal()">×</button>
            </div>
            <div class="custom-modal-content">
                <input type="text" class="custom-modal-input" id="addUserUsername" placeholder="输入 用户名 或 ID">
                <div class="custom-modal-buttons">
                    <button class="custom-modal-btn cancel" onclick="closeAddUserModal()">取消</button>
                    <button class="custom-modal-btn confirm" onclick="confirmAddUser()">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->

    <!--#region 用户详情管理弹窗 HTML -->

    <div class="custom-modal-overlay" id="userDetailModal">
        <div class="custom-modal-panel user-detail-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">👤 用户详情</span>
                <button class="custom-modal-close" onclick="closeUserDetailModal()">×</button>
            </div>
            <div class="custom-modal-content user-detail-content" id="userDetailContent">
                <!-- 动态生成 -->
            </div>
        </div>
    </div>
    <!--#endregion -->

    <!--#endregion -->

    <!--#region 超级管理员密码验证弹窗 HTML -->
    <div class="custom-modal-overlay" id="superAdminPasswordModal" style="display: none;">
        <div class="custom-modal-panel">
            <div class="custom-modal-header">
                <span class="custom-modal-title">🔴 超级管理员验证</span>
                <button class="custom-modal-close" onclick="closeSuperAdminPasswordModal()">×</button>
            </div>
            <div class="custom-modal-content">
                <form onsubmit="event.preventDefault(); verifySuperAdminPassword();" autocomplete="off">
                    <input type="text" name="username" autocomplete="username" style="display:none;" value="super-admin">
                    <input type="password" class="custom-modal-input" id="superAdminPasswordInput"
                        placeholder="请输入超级管理员密码" autocomplete="current-password">
                    <div class="custom-modal-buttons">
                        <button type="button" class="custom-modal-btn cancel"
                            onclick="closeSuperAdminPasswordModal()">取消</button>
                        <button type="submit" class="custom-modal-btn confirm">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 超级管理员控制面板 HTML -->
    <div class="custom-modal-overlay" id="superAdminPanel" style="display: none;">
        <div class="custom-modal-panel super-admin-panel-container">
            <!-- Left Sidebar -->
            <div class="super-admin-sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-logo">后台管理系统  </div>
                    <div class="sidebar-subtitle">控制中心</div>
                </div>
                <nav class="sidebar-nav">
                    <button class="sidebar-btn active" onclick="switchSuperAdminTab('servers')">
                        <span class="icon">🖥️</span> 服务器管理
                    </button>
                    <button class="sidebar-btn" onclick="switchSuperAdminTab('users')">
                        <span class="icon">👥</span> 数据管理
                    </button>
                    <button class="sidebar-btn" onclick="switchSuperAdminTab('recharge')">
                        <span class="icon">💰</span> 充值
                    </button>
                    <button class="sidebar-btn" id="saTabRates" onclick="switchSuperAdminTab('rates')">
                        <span class="icon">📈</span> 费率设置
                    </button>
                    <button class="sidebar-btn" onclick="switchSuperAdminTab('logs')">
                        <span class="icon">📝</span> 系统日志
                    </button>
                    <button class="sidebar-btn" onclick="switchSuperAdminTab('settings')">
                        <span class="icon">⚙️</span> 设置
                    </button>
                </nav>
                <div class="sidebar-footer">
                    <button class="sidebar-btn backup-btn" onclick="closeSuperAdminPanel()">
                        <span class="icon">↩️</span> 返回
                    </button>
                </div>
            </div>

            <!-- Right Main Area -->
            <div class="super-admin-main-area">
                <div class="main-area-header">
                    <div class="header-title">
                        <span class="status-indicator online"></span>
                        MAC OS SERVERS
                    </div>
                    <div class="manager-time-display" id="superAdminTimeDisplay" style="left: auto; right: 50px; transform: none;">
                        <span class="time-date" id="superAdminTimeDate">--/--/----</span>
                        <span class="time-clock" id="superAdminTimeClock">--:--</span>
                    </div>
                    <button class="close-btn" onclick="closeSuperAdminPanel()">×</button>
                </div>

                <div class="main-area-content">
                    <!-- 服务器列表 (默认显示) -->
                    <div class="servers-radar-section" id="superAdminServersSection">
                        <div class="super-admin-servers-grid" id="superAdminServersList">
                            <!-- Dynamically generated Radar Bots -->
                        </div>
                    </div>

                    <!-- 数据管理面板 -->
                    <div id="superAdminUserSection" style="display: none; height: 100%; padding: 20px; overflow-y: auto;">
                        <!-- 三个切换按钮 -->
                        <div class="sa-data-tabs">
                            <button class="sa-data-tab-btn" id="btnSaDataUser" onclick="saSwitchDataTab('user')">用户数据</button>
                            <button class="sa-data-tab-btn" id="btnSaDataAdmin" onclick="saSwitchDataTab('admin')">管理员数据</button>
                            <button class="sa-data-tab-btn" id="btnSaDataServer" onclick="saSwitchDataTab('server')">服务器数据</button>
                        </div>
                    
                        <!-- 用户数据面板 -->
                        <div id="saDataUserPanel" style="display: none;">
                            <div id="saUserInfoRow" style="display: flex; align-items: center; margin-top: 30px; gap: 20px;">
                                <span style="font-size: 14px; color: #fff;">注册用户: <span id="saTotalUserCount" style="color: #4facfe; font-weight: bold;">0</span></span>
                                <span id="saSearchIcon" class="sa-search-icon" onclick="saToggleUserSearch()">🔍</span>
                                <div id="saUserSearchContainer" style="display: none; align-items: center; gap: 10px;">
                                    <input type="text" id="saUserSearchInput" placeholder="输入用户ID" 
                                        style="width: 100px; background: #2d2d42; border: 1px solid #555; color: #fff; padding: 6px 12px; border-radius: 4px; outline: none; font-size: 13px;"
                                        onkeypress="if(event.key==='Enter') saConfirmUserSearch()">
                                    <button onclick="saConfirmUserSearch()" class="sa-search-confirm-btn">确定</button>
                                </div>
                            </div>
                            <div id="saAllUserList" class="user-buttons-grid" style="margin-top: 30px; grid-template-columns: repeat(4, 1fr); gap: 30px;"></div>
                        </div>
                    
                        <!-- 管理员数据面板 -->
                        <div id="saDataAdminPanel" style="display: none;"></div>
                    
                        <!-- 服务器数据面板 -->
                        <div id="saDataServerPanel" style="display: none;"></div>
                    </div>


                    <!-- 充值面板 (点击Recharge按钮显示) -->
                    <div id="superAdminRechargeSection" style="display: none; height: 100%; padding: 20px; overflow-y: auto;">
                        <!-- 操作区域 -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="color: #ccc; font-size: 14px;">用户名:</span>
                                    <input type="text" id="saRechargeUserIdInput" placeholder="输入用户名"
                                        style="background: #2d2d42; border: 1px solid #3f3f5f; color: #fff; padding: 8px 12px; border-radius: 6px; width: 180px; font-size: 13px;">
                                </div>
                                <button class="gui-btn primary" onclick="saVerifyRechargeUser()"
                                    style="width: 100px; padding: 8px 12px; background: #4facfe; color: white; border: none; border-radius: 6px; cursor: pointer;">验证用户</button>
                                <div style="width: 1px; height: 30px; background: #3f3f5f;"></div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="color: #ccc; font-size: 14px;">充值金额:</span>
                                    <input type="number" id="saRechargeAmountInput" placeholder="金额"
                                        step="0.01"
                                        style="background: #2d2d42; border: 1px solid #3f3f5f; color: #fff; padding: 8px 12px; border-radius: 6px; width: 120px; font-size: 13px;">
                                </div>
                                <button class="gui-btn primary" onclick="saConfirmRecharge()"
                                    style="width: 100px; padding: 8px 12px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">确定充值</button>
                                <button class="gui-btn" onclick="saResetRecharge()"
                                    style="width: 100px; padding: 8px 12px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer;">完成</button>
                            </div>
                        </div>

                        <!-- 用户信息区域 -->
                        <div id="saRechargeUserInfoPanel" style="display: none; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">用户名:</span> <span id="saRechargeInfoUsername" style="color: #4facfe;">-</span></div>
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">用户ID:</span> <span id="saRechargeInfoUserId" style="color: #fff;">-</span></div>
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">注册时间:</span> <span id="saRechargeInfoCreated" style="color: #fff;">-</span></div>
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">当前余额:</span> <span id="saRechargeInfoCredits" style="color: #00ff88;">-</span></div>
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">上次充值:</span> <span id="saRechargeInfoLastRecharge" style="color: #fff;">-</span></div>
                                <div style="display: flex; gap: 8px;"><span style="color: #888;">总消费:</span> <span id="saRechargeInfoTotalSpent" style="color: #ff9800;">-</span></div>
                            </div>
                        </div>

                        <!-- 充值记录区域 -->
                        <div>
                            <div style="color: #fff; font-size: 14px; font-weight: bold; margin-bottom: 10px;">充值记录</div>
                            <div id="saRechargeRecordsList" style="min-height: 300px; max-height: 500px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; font-family: monospace; font-size: 12px; color: #ccc;">
                                <div style="padding: 10px; text-align: center; color: #888;">请先验证用户以查看充值记录...</div>
                            </div>
                        </div>
                    </div>


                    <!-- 费率设置面板 -->
                    <div id="superAdminRatesSection" style="display: none; height: 100%; padding: 20px; overflow-y: auto;">

                        <!-- 1. 全局费率 -->
                        <div style="margin-bottom: 30px;">
                            <div style="color: #fff; font-size: 16px; font-weight: bold; margin-bottom: 15px;">全局费率</div>
                            
                            <!-- Display Mode -->
                            <div class="rate-row" id="saGlobalDisplay" style="margin-bottom: 15px;">
                                 <span style="color:#ddd; font-size:14px;">发送: <span id="saGlobalDispSend" style="color:#4facfe; font-weight:bold;">-</span></span>
                                 <span style="color:#ddd; font-size:14px; margin-left:15px;">接收: <span id="saGlobalDispRecv" style="color:#00ff88; font-weight:bold;">-</span></span>
                                 <span style="color:#ddd; font-size:14px; margin-left:15px;">失败: <span id="saGlobalDispFail" style="color:#ff5252; font-weight:bold;">-</span></span>
                                 <span style="color:#ddd; font-size:14px; margin-left:15px;">私享: <span id="saGlobalDispPrivate" style="color:#ff9800; font-weight:bold;">-</span></span>
                                 <button class="rate-btn primary" onclick="saShowGlobalEdit()" style="margin-left:auto;">设置</button>
                            </div>

                            <!-- Edit Mode -->
                            <div class="rate-row" id="saGlobalEdit" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                                <label>发送：</label><input type="number" id="saGlobalSend" class="rate-input">
                                <label>接收：</label><input type="number" id="saGlobalRecv" class="rate-input">
                                <label>失败：</label><input type="number" id="saGlobalFail" class="rate-input">
                                <label>私享服务器：</label><input type="number" id="saGlobalPrivate" class="rate-input">
                                <div style="flex: 1"></div>
                                <button class="rate-btn warning" onclick="saResetGlobal()">重置</button>
                                <button class="rate-btn danger" onclick="saCancelGlobal()">取消</button>
                                <button class="rate-btn primary" onclick="saSaveGlobal()">确定</button>
                            </div>
                        </div>

                        <!-- 2. 管理员费率范围设置 -->
                        <div style="margin-bottom: 30px;">
                            <div style="color: #fff; font-size: 16px; font-weight: bold; margin-bottom: 15px;">管理员费率范围设置</div>
                            <div style="color: #888; font-size: 12px; margin-bottom: 15px;">
                                设置管理员可以给自己创建的用户设置的费率范围（小数点后4位，例如：0.0200-0.0300）
                            </div>
                            <div class="rate-row" style="margin-bottom: 15px;">
                                <label>管理员ID：</label>
                                <input type="text" id="saSalesSearchUser" class="rate-input"
                                    style="width: 150px !important;" placeholder="输入管理员ID">
                                <button class="rate-btn primary" onclick="saVerifySalesperson()">验证</button>

                                <!-- 验证通过后显示的设置区域 (初始隐藏) -->
                                <div id="saSalesSettingArea"
                                    style="display: none; align-items: center; gap: 10px; margin-left: 15px;">
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <label style="color: #ccc;">可调整范围：</label>
                                        <input type="number" id="saSalesRangeMin" class="rate-input"
                                            style="width: 100px !important;" step="0.0001" min="0.0001" placeholder="最小费率">
                                        <span style="color: #fff;">-</span>
                                        <input type="number" id="saSalesRangeMax" class="rate-input"
                                            style="width: 100px !important;" step="0.0001" min="0.0001" placeholder="最大费率">
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="rate-btn danger" onclick="saCancelSales()">取消</button>
                                        <button class="rate-btn primary" onclick="saSaveSales()">确定</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 错误提示 -->
                            <div id="saSalesError" class="rate-error-msg"
                                style="display: none; margin-bottom: 10px;">
                                管理员不存在，请输入正确的管理员ID
                            </div>

                            <!-- 已授权管理员列表 -->
                            <div class="rate-list-container">
                                <div class="rate-list-header">
                                    <span>管理员ID</span>
                                    <span>授权调整费率范围</span>
                                    <span style="text-align: right;">操作</span>
                                </div>
                                <div id="saSalesList" class="rate-list-body">
                                    <div style="padding: 10px; color: #888; text-align: center;">暂无数据</div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. 指定用户费率 -->
                        <div style="margin-bottom: 30px;">
                            <div style="color: #fff; font-size: 16px; font-weight: bold; margin-bottom: 15px;">指定用户费率</div>
                            <div class="rate-row" style="margin-bottom: 15px;">
                                <label>用户ID：</label>
                                <input type="text" id="saUserSearchName" class="rate-input"
                                    style="width: 150px !important;">
                                <button class="rate-btn primary" onclick="saVerifyUser()">验证</button>
                            </div>

                            <!-- 错误提示 -->
                            <div id="saUserError" class="rate-error-msg"
                                style="display: none; margin-bottom: 10px;">
                                用户不存在请输入正确的用户Id
                            </div>

                            <!-- 设置区域 (初始隐藏) -->
                            <div id="saUserSettingArea"
                                style="display: none; margin-bottom: 15px; padding: 15px; border-radius: 8px;">
                                <div class="rate-row">
                                    <label>费率设置：</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                            <label style="font-size: 10px; color: #888;">发送</label>
                                            <input type="number" id="saUserSend" class="rate-input">
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                            <label style="font-size: 10px; color: #888;">接收</label>
                                            <input type="number" id="saUserRecv" class="rate-input">
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                            <label style="font-size: 10px; color: #888;">失败</label>
                                            <input type="number" id="saUserFail" class="rate-input">
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                            <label style="font-size: 10px; color: #888;">私享</label>
                                            <input type="number" id="saUserPrivate" class="rate-input">
                                        </div>
                                    </div>
                                    <div style="margin-left: 20px; display: flex; gap: 10px;">
                                        <button class="rate-btn danger" onclick="saCancelUser()">取消</button>
                                        <button class="rate-btn primary" onclick="saSaveUser()">确定</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 指定费率用户列表 -->
                            <div class="rate-list-container">
                                <div class="rate-list-header" style="grid-template-columns: 100px 1fr 60px;">
                                    <span>用户ID</span>
                                    <span>费率 (发送 / 接收 / 失败 / 私享)</span>
                                    <span style="text-align: right;">操作</span>
                                </div>
                                <div id="saUserList" class="rate-list-body"></div>
                            </div>
                        </div>
                    </div>

                    <style>
                        /* 费率管理面板 */
                        .rate-row {
                            display: flex;
                            align-items: center;
                            gap: 15px;
                            flex-wrap: wrap;
                        }

                        .rate-row label {
                            color: #ddd;
                            font-size: 14px;
                            text-align: left;
                            /* Label 左对齐 */
                        }

                        .rate-input {
                            width: 100px !important;
                            /* 统一输入框宽度 100px */
                            background: #252530;
                            border: 1px solid #555;
                            color: #fff;
                            padding: 6px 10px;
                            border-radius: 4px;
                            outline: none;
                            height: 32px;
                            box-sizing: border-box;
                        }

                        .rate-input:focus {
                            border-color: #4facfe;
                            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.2);
                        }

                        .rate-actions {
                            display: flex;
                            gap: 20px;
                            /* 按钮间隔 */
                            margin-top: 20px;
                        }

                        .rate-actions.centered {
                            justify-content: center;
                            /* 按钮居中排列 */
                        }

                        .rate-btn {
                            width: 70px !important;
                            height: 26px !important;
                            line-height: 26px !important;
                            border-radius: 16px !important;
                            padding: 0 !important;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border: 1px solid #555;
                            background: #333;
                            color: #fff;
                            cursor: pointer;
                            transition: all 0.2s;
                            font-size: 12px;
                        }

                        .rate-btn:hover {
                            background: #444;
                            transform: translateY(-1px);
                        }

                        .rate-btn.primary {
                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                            border: none;
                            color: #fff;
                            font-weight: bold;
                        }

                        .rate-btn.primary:hover {
                            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3);
                        }

                        .rate-btn.warning {
                            background: #ff9800;
                            border: none;
                        }

                        .rate-btn.danger {
                            background: #ff5252;
                            border: none;
                        }

                        .rate-error-msg {
                            color: #ff5252;
                            margin-top: 8px;
                            font-size: 13px;
                            padding-left: 5px;
                        }

                        /* 新增列表样式 */
                        .rate-list-container {
                            margin-top: 20px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            overflow: hidden;
                            display: none; /* 默认隐藏 */
                        }
                        
                        /* 当 .rate-list-body 有子元素时显示容器 */
                        .rate-list-container:has(.rate-list-body:not(:empty)) {
                            display: block;
                        }

                        .rate-list-header {
                            display: grid;
                            grid-template-columns: 150px 1fr 60px;
                            gap: 10px;
                            padding: 10px 15px;
                            background: rgba(0, 0, 0, 0.3);
                            color: #aaa;
                            font-size: 12px;
                            font-weight: bold;
                        }

                        .rate-list-body {
                            max-height: 200px;
                            overflow-y: auto;
                            background: rgba(0, 0, 0, 0.1);
                        }
                        
                        /* 确保 JS 清空内容后也能正确隐藏，需要配合 JS 移除空文本节点 */
                        .rate-list-body:empty {
                            display: none;
                        }

                        .rate-list-item {
                            display: grid;
                            grid-template-columns: 150px 1fr 60px;
                            gap: 10px;
                            padding: 8px 15px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                            font-size: 13px;
                            align-items: center;
                            color: #ddd;
                        }

                        .rate-list-item:last-child {
                            border-bottom: none;
                        }

                        .rate-list-btn {
                            width: 20px;
                            height: 20px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: transparent;
                            border: none;
                            color: #ff5252;
                            cursor: pointer;
                            font-size: 14px;
                        }

                        .rate-list-btn:hover {
                            color: #ff8a80;
                        }
                    </style>
                </div>


                    <!-- 日志面板 -->
                    <div id="superAdminLogsSection" style="display: none; height: 100%; padding: 20px; overflow-y: auto;">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <button id="btnLogHTML" class="log-type-btn" onclick="switchLogType('html')" style="width: 100px; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">HTML</button>
                            <button id="btnLogAPI" class="log-type-btn" onclick="switchLogType('api')" style="width: 100px; padding: 8px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">API</button>
                            <button id="btnLogWorker" class="log-type-btn" onclick="switchLogType('worker')" style="width: 100px; padding: 8px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer;">Worker</button>
                            <button id="btnLogRecord" class="log-type-btn" onclick="switchLogType('record')" style="width: 100px; padding: 8px; background: #9C27B0; color: white; border: none; border-radius: 4px; cursor: pointer;">Record</button>
                        </div>
                        <div id="superAdminLogContent" style="min-height: 400px; max-height: calc(100vh - 200px); overflow-y: auto; padding: 10px; font-family: monospace; font-size: 12px; color: #ccc; background: rgba(0,0,0,0.3); border-radius: 8px;">
                            <!-- 日志内容 -->
                        </div>
                    </div>

                    <!-- Operation Panel (Shown after selecting a server) -->
                <div class="operation-panel-wrapper" id="superAdminDetailSection" style="display: none;">
                    <div class="operation-panel-header">
                        <span class="panel-title" id="opPanelTitle">服务器操作</span>
                        <div class="panel-controls">
                            <span class="server-id-tag" id="opPanelServerId">ID: -</span>
                        </div>
                    </div>
                    <div class="operation-panel-content">
                        <!-- Simplified Local GUI Mockup -->
                        <div class="gui-mockup">
                            <div class="gui-row">
                                <div class="gui-group">
                                    <label>信息 (Information)</label>
                                    <div class="gui-info-box">
                                        <div class="info-line"><span class="label">号码:</span> <span
                                                id="superAdminNumber" class="value">-</span></div>
                                        <div class="info-line"><span class="label">邮箱:</span> <span id="superAdminEmail"
                                                class="value">-</span></div>
                                        <div class="info-line"><span class="label">端口:</span> <span id="superAdminPort"
                                                class="value">-</span></div>
                                        <div class="info-line"><span class="label">API:</span> <span id="superAdminApi"
                                                class="value">-</span></div>
                                    </div>
                                </div>
                                <div class="gui-group">
                                    <label>控制 (Control)</label>
                                    <div class="gui-btn-group">
                                        <button class="gui-btn primary" id="superAdminServerStatusBtn"
                                            onclick="toggleSuperAdminServer()">启动服务器</button>
                                        <button class="gui-btn warning"
                                            onclick="sendSuperAdminCommand('restart')">重启服务</button>
                                    </div>
                                </div>
                            </div>
                            <div class="gui-row">
                                <div class="gui-group full-width">
                                    <label>诊断与维护 (Diagnostics)</label>
                                    <div class="gui-btn-group wrap">
                                        <button class="gui-btn"
                                            onclick="sendSuperAdminCommand('diagnose')">系统诊断</button>
                                        <button class="gui-btn"
                                            onclick="sendSuperAdminCommand('db_diagnose')">数据库检查</button>
                                        <button class="gui-btn"
                                            onclick="sendSuperAdminCommand('fix_permission')">修复权限</button>
                                        <button class="gui-btn danger"
                                            onclick="sendSuperAdminCommand('clear_inbox')">清空收件箱</button>
                                    </div>
                                </div>
                            </div>
                            <div class="gui-row grow">
                                <div class="gui-group full-width full-height">
                                    <label>控制台输出 (Console)</label>
                                    <div class="gui-console" id="superAdminDetailLogContent">
                                        <div class="log-line system">等待命令...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!--#endregion -->


    <!--#region 主应用页面 HTML -->

    <div class="content-wrapper" style="display: none;">
        <!-- 导航按钮栏 -->
        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn active" id="navHomeBtn">主页面</button>
                <button class="nav-btn" id="navAccountBtn">账号管理</button>
                <button class="nav-btn" id="navSendBtn">IMessage</button>
                <button class="nav-btn" id="navInboxBtn">收件箱
                    <div class="notification-count">0</div>
                </button>
                <button class="nav-btn" id="navLogoutBtn" onclick="handleLogout()">退出账号</button>
            </div>
        </div>
        <div class="main-container" style="display: none;">
            <!-- 工作区A+B -->
            <div class="workspace-ab" id="workspaceAB" style="display: none;">
                <!-- A版面板 -->
                <div class="panel-a" style="position: relative;">
                    <div class="manager-time-display" id="mainPageTimeDisplay" style="left: auto; right: 0; top: -40px; transform: none;">
                        <span class="time-date" id="mainPageTimeDate">--/--/----</span>
                        <span class="time-clock" id="mainPageTimeClock">--:--</span>
                    </div>
                    <div class="panel-header">
                        <span>AutoSender Pro</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="currency-toggle" id="currencyToggle" onclick="toggleCurrencyMode()">
                                <div class="toggle-slider"></div>
                                <div class="toggle-label label-credit">积分</div>
                                <div class="toggle-label label-usd">USD</div>
                            </div>
                            <span id="userInfoDisplay"
                                style="font-family: 'Xiaolai', sans-serif; font-size: 12px; color: var(--text-dark); display: none;">
                                <span id="currentUsername"></span> | 余额: <span id="currentCredits">-</span>
                            </span>
                            <div class="connection-status" id="connectionStatus"><span>连接中...</span></div>
                        </div>
                    </div>

                    <div class="panel-content">
                        <div class="content-area">
                            <!-- 左侧号码输入框 -->
                            <div class="numbers-container">
                                <div class="input-header">
                                    <div class="input-title">发送号码</div>
                                    <div class="input-actions">
                                        <button class="btn-icon" id="importNumbersBtn" title="导入">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon" id="clearNumbersBtn" title="清空">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="input-area">
                                    <textarea id="numbersText" placeholder="输入目标号码，每行一个"></textarea>
                                    <div class="char-count" id="numbersCount">号码: 0</div>
                                </div>
                                <!-- 延长按钮 -->
                                <div class="anchor-trigger" id="numTrigger"></div>
                            </div>

                            <!-- 右侧消息输入框 -->
                            <div class="message-container">
                                <div class="input-header">
                                    <div class="input-title">发送内容</div>
                                    <div class="input-actions">
                                        <button class="btn-icon" id="importMessageBtn" title="导入">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon" id="clearMessageBtn" title="清空">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="input-area">
                                    <textarea id="messageText" placeholder="输入要发送的消息内容"></textarea>
                                    <div class="char-count" id="messageCount">字符: 0</div>
                                </div>
                            </div>
                        </div>

                        <div class="control-bar">
                            <button class="btn-log-panel" id="logPanelBtn">日志面板</button>
                            <!-- A版中的统计栏（当B版未打开时显示） -->
                            <div class="stats-bar-inline" id="statsBarInline">
                                <div class="stat-item">任务次数: <span class="stat-value" id="taskCountInline">0</span>
                                </div>
                                <div class="stat-item">总号码: <span class="stat-value" id="phoneCountInline">0</span>
                                </div>
                                <div class="stat-item">总数量: <span class="stat-value" id="totalSentCountInline">0</span>
                                </div>
                                <div class="stat-item">成功: <span class="stat-value" id="successCountInline">0</span>
                                </div>
                                <div class="stat-item">失败: <span class="stat-value" id="failCountInline">0</span></div>
                                <div class="stat-item">成功率: <span class="stat-value" id="successRateInline">0%</span>
                                </div>
                            </div>
                            <div class="interval-control">
                                <span class="interval-label">发送间隔:</span>
                                <select class="interval-select" id="intervalInput">
                                    <option value="0.3">0.3s</option>
                                    <option value="0.7">0.7s</option>
                                    <option value="1.0" selected>1.0s</option>
                                    <option value="1.5">1.5s</option>
                                    <option value="2.0">2.0s</option>
                                </select>
                            </div>
                            <button class="btn-send" id="sendBtn">发送</button>
                        </div>
                    </div>
                </div>
                <!-- B版面板（桌面端AB并排） -->
                <div class="panel-b desktop-only">
                    <div class="panel-header">
                        <span>任务日志</span>
                    </div>
                    <div class="panel-content" style="position: relative;">
                        <div class="log-box" id="statusList">
                            <!-- 日志内容将通过JavaScript动态添加 -->
                        </div>
                        <!-- 清空按钮 - 放在日志容器右下角 -->
                        <button class="btn-clear-logs" id="clearLogsBtn" title="清空日志">清空</button>
                        <div class="stats-bar">
                            <div class="stat-item">任务次数: <span class="stat-value" id="taskCount">0</span></div>
                            <div class="stat-item">总号码: <span class="stat-value" id="phoneCount">0</span></div>
                            <div class="stat-item">总数量: <span class="stat-value" id="totalSentCount">0</span></div>
                            <div class="stat-item">成功: <span class="stat-value" id="successCount">0</span></div>
                            <div class="stat-item">失败: <span class="stat-value" id="failCount">0</span></div>
                            <div class="stat-item">成功率: <span class="stat-value" id="successRate">0%</span></div>
                        </div>
                        <!-- 延长按钮 -->
                        <div class="anchor-trigger" id="logTrigger"></div>
                    </div>
                </div>
            </div>
            <!-- B版面板（移动端独立显示） -->
            <div class="panel-b-mobile" id="panelB">
                <div class="panel-header">
                    <span>任务日志</span>
                </div>
                <div class="panel-content">
                    <div class="log-box" id="statusListMobile">
                        <!-- 日志内容将通过JavaScript动态添加 -->
                    </div>
                    <div class="stats-bar">
                        <div class="stat-item">任务次数: <span class="stat-value" id="taskCountMobile">0</span></div>
                        <div class="stat-item">总号码: <span class="stat-value" id="phoneCountMobile">0</span></div>
                        <div class="stat-item">总数量: <span class="stat-value" id="totalSentCountMobile">0</span></div>
                        <div class="stat-item">成功: <span class="stat-value" id="successCountMobile">0</span></div>
                        <div class="stat-item">失败: <span class="stat-value" id="failCountMobile">0</span></div>
                        <div class="stat-item">成功率: <span class="stat-value" id="successRateMobile">0%</span></div>
                    </div>
                    <!-- 底部按钮区域 -->
                    <div class="panel-b-controls">
                        <button class="btn-back-to-send" id="backToSendBtn">IMessage</button>
                        <button class="btn-clear-logs-mobile" id="clearLogsBtnMobile" title="清空日志">清空</button>
                    </div>
                </div>
            </div>
            <!-- 欢迎面板 -->
            <div class="panel-d" id="panelD" style="display: none;">
                <div class="main-title">AutoSender Pro</div>
                <div class="main-subtitle">IMessage sender</div>
            </div>
            <!-- 收件箱面板 -->
            <div class="panel-c" id="panelC" style="display: none;">
                <div class="panel-header">
                    <span>收件箱</span>
                    <span id="inboxStats"
                        style="font-family: 'Xiaolai', sans-serif; font-size: 13px; padding: 4px 10px; background: rgba(47, 47, 47, 0.1); border-radius: 12px;">接收:
                        0 发送: 0 总数: 0</span>
                </div>
                <div class="panel-content">
                    <div class="inbox-layout">
                        <div class="contact-list" id="contactList" style="position: relative;">
                            <!-- 联系人列表将通过JavaScript动态添加 -->
                            <button class="btn-clear-inbox" id="clearInboxBtn" title="全部删除">全部删除</button>
                        </div>
                        <div class="chat-area">
                            <div class="chat-header" id="chatHeader"
                                style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                                <span class="phone-number" id="chatPhoneNumber" style="flex: 1;">选择一个对话</span>
                                <div id="exclusivePhoneSelector" style="display: none; position: relative;">
                                    <button id="exclusivePhoneBtn"
                                        style="padding: 6px 12px; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); border: 2px solid var(--border-dark); border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 12px; white-space: nowrap;">
                                        本机号码: <span id="currentPhoneDisplay">-</span> <span
                                            style="font-size: 10px;">▼</span>
                                    </button>
                                    <div id="exclusivePhoneDropdown"
                                        style="display: none; position: absolute; top: 100%; right: 0; margin-top: 5px; background: white; border: 2px solid var(--border-dark); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; min-width: 150px; max-height: 200px; overflow-y: auto;">
                                        <!-- 动态生成号码列表 -->
                                    </div>
                                </div>
                            </div>
                            <div class="chat-display" id="conversationDisplay">
                                <!-- 对话内容将通过JavaScript动态添加 -->
                            </div>
                            <div class="reply-bar">
                                <input type="text" class="reply-input" id="replyInput" placeholder="输入回复消息...">
                                <button class="btn-send-reply" id="sendReplyBtn">发送</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 账号管理面板 -->
            <div class="panel-e" id="panelE" style="display: none;">
                <div class="panel-header">
                    <span>账号管理</span>
                </div>
                <div class="panel-content">
                    <!-- 账号管理内容区域 -->
                </div>
            </div>
        </div>
    </div>
    <!--#endregion -->
    <!--#region 文件输入 HTML -->
    <input type="file" id="numbersFile" class="file-input" accept=".txt,.csv">
    <input type="file" id="messageFile" class="file-input" accept=".txt">
    <!--#endregion -->
    <!-- 前端日志收集 -->
    <script>
        (function() {
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;
            const originalInfo = console.info;
            
            // 日志缓冲区，批量发送
            const logBuffer = [];
            let sendTimer = null;
            const BATCH_SIZE = 10;
            const BATCH_INTERVAL = 5000; // 5秒批量发送一次
            
            // 过滤不需要保存的日志
            function shouldSaveLog(message) {
                // 过滤HTTP请求日志
                if (message.includes('POST /api/admin/logs/save') || 
                    message.includes('GET /api/admin/logs') ||
                    message.includes('HTTP/1.1')) {
                    return false;
                }
                // 过滤心跳相关日志
                if (message.toLowerCase().includes('ping') || 
                    message.toLowerCase().includes('pong') ||
                    message.toLowerCase().includes('心跳')) {
                    return false;
                }
                return true;
            }
            
            function sendLogBatch() {
                if (logBuffer.length === 0) return;
                
                const logsToSend = logBuffer.splice(0, BATCH_SIZE);
                
                try {
                    // 🔥 安全检查：确保 API_BASE_URL 已定义
                    const apiUrl = (typeof API_BASE_URL !== 'undefined' && API_BASE_URL) ? API_BASE_URL : '/api';
                    // 连续失败退避/熔断，避免 524 风暴把后端压死
                    window.__logSendFailCount = window.__logSendFailCount || 0;
                    window.__logSendBackoffMs = window.__logSendBackoffMs || BATCH_INTERVAL;
                    if (window.__logSendDisabled) return;
                    fetch(`${apiUrl}/admin/logs/save`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'html',
                            logs: logsToSend
                        })
                    })
                    .then(res => {
                        if (!res.ok) throw new Error(String(res.status));
                        window.__logSendFailCount = 0;
                        window.__logSendBackoffMs = BATCH_INTERVAL;
                    })
                    .catch((e) => {
                        window.__logSendFailCount = (window.__logSendFailCount || 0) + 1;
                        const msg = String(e && (e.message || e) || '');
                        if (msg.includes('524') && window.__logSendFailCount >= 3) {
                            window.__logSendDisabled = true;
                            // 只打印一次，避免刷屏
                            originalWarn('[前端日志] /api/admin/logs/save 连续 524，已自动停用上报（避免压垮后端）');
                            return;
                        }
                        window.__logSendBackoffMs = Math.min(60000, Math.floor((window.__logSendBackoffMs || BATCH_INTERVAL) * 1.8));
                    });
                } catch (e) {}
                
                // 如果还有日志，继续发送
                if (logBuffer.length > 0) {
                    const delay = (window.__logSendBackoffMs || BATCH_INTERVAL);
                    sendTimer = setTimeout(sendLogBatch, delay);
                } else {
                    sendTimer = null;
                }
            }
            
            function addToBuffer(level, message) {
                if (!shouldSaveLog(message)) return;
                // 如果已经熔断日志上报，就别继续堆积内存了（否则长时间会把页面拖死）
                if (window.__logSendDisabled) return;
                
                logBuffer.push({
                    level: level.toUpperCase(),
                    message: message,
                    detail: {},
                    ts: new Date().toISOString()
                });

                // 防止缓冲区无限增长导致页面卡死
                const MAX_BUFFER = 200;
                if (logBuffer.length > MAX_BUFFER) {
                    logBuffer.splice(0, logBuffer.length - MAX_BUFFER);
                }
                
                // 如果缓冲区满了，立即发送
                if (logBuffer.length >= BATCH_SIZE) {
                    if (sendTimer) {
                        clearTimeout(sendTimer);
                        sendTimer = null;
                    }
                    sendLogBatch();
                } else if (!sendTimer) {
                    // 否则设置定时器批量发送
                    sendTimer = setTimeout(sendLogBatch, BATCH_INTERVAL);
                }
            }
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg);
                        } catch {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                // 只保存error和warn，不保存info/log，避免刷屏
                // addToBuffer('info', message);
            };
            
            console.error = function(...args) {
                originalError.apply(console, args);
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg);
                        } catch {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                addToBuffer('error', message);
            };
            
            console.warn = function(...args) {
                originalWarn.apply(console, args);
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg);
                        } catch {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                addToBuffer('warn', message);
            };
            
            console.info = function(...args) {
                originalInfo.apply(console, args);
                // 不保存info日志，避免刷屏
            };
        })();
    </script>
    <!-- <script src="js.js"></script> -->
    <script src="static/logic_sign_login.js?v=20260114_1"></script>
    <script src="static/admin_page.js?v=20260114_1"></script>
    <script src="static/server_page.js?v=20260114_1"></script>
    <script src="static/dadfunction.js?v=20260114_1"></script>
    <script src="static/fordisplay.js?v=20260114_1"></script>
    <script src="static/superadmin_page.js?v=20260114_1"></script>
</body>

</html>